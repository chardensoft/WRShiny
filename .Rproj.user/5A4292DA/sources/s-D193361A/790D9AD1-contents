### to JSON!!!! #######
rm(list = ls())
library(jsonlite)
setwd("~/Desktop/curr_Chris/WoodReport/xcData")


############ MEN
testrunners <- read.csv("database files/Mrunners.csv")
testrunners <- testrunners[which(testrunners$active == "active"),]
testrunners <- testrunners[,-which(colnames(testrunners) %in% c("RUNNER.ID"))]
# testrunners$place <- as.integer(testrunners$place)
# testrunners$rank <- as.numeric(testrunners$rank)
# testrunners$previous_rank <- as.numeric(testrunners$previous_rank)
# testrunners$previous_place <- as.integer(testrunners$previous_place)
write_json(testrunners, "WRShiny/www/runners.json")
test_teams <- read.csv("database files/Mteams.csv")
write_json(test_teams, "WRShiny/www/teams.json")
testraces <- read.csv("database files/Mraces.csv")
write_json(testraces, "WRShiny/www/races.json")


############ WOMEN
Wtestrunners <- read.csv("database files/Wrunners.csv")
Wtestrunners <- Wtestrunners[which(Wtestrunners$active == "active"),]
Wtestrunners <- Wtestrunners[,-which(colnames(Wtestrunners) %in% c("RUNNER.ID"))]
# Wtestrunners$place <- as.integer(Wtestrunners$place)
# Wtestrunners$rank <- as.numeric(Wtestrunners$rank)
# Wtestrunners$previous_rank <- as.numeric(Wtestrunners$previous_rank)
# Wtestrunners$previous_place <- as.integer(Wtestrunners$previous_place)
write_json(Wtestrunners, "WRShiny/www/Wrunners.json")
Wtest_teams <- read.csv("database files/Wteams.csv")
write_json(Wtest_teams, "WRShiny/www/Wteams.json")
Wtestraces <- read.csv("database files/Wraces.csv")
write_json(Wtestraces, "WRShiny/www/Wraces.json")
updated <- read_json("WRShiny/www/updated.json")
did <- as.character(updated[[1]]$did)
write_json(data.frame(did=did, updated=substr(date(), 5, 10)), "WRShiny/www/updated.json")


##### Other Data
div <- data.frame(name = unique(c(Wtest_teams$div, test_teams$div)))
conf <- data.frame(name = unique(c(Wtest_teams$conf, test_teams$conf)))
region <- data.frame(name = unique(c(Wtest_teams$reg, test_teams$reg)))

write_json(div, "WRShiny/www/div.json")
write_json(conf, "WRShiny/www/conf.json")
write_json(region, "WRShiny/www/region.json")









